<!--
Sync Impact Report - Constitution Update v1.1.0

Version Change: 1.0.0 â†’ 1.1.0 (MINOR - Added Phase II Progress Section)

Modified Sections:
- Added "Phase II: Implementation Progress" section after Phase II Architecture
- Updated Phase II Success Criteria with completion status
- Added new principle VIII: "Multi-Language and Accessibility"
- Updated Phase II Bonus Features with completion status

Added Sections:
- Phase II: Implementation Progress (NEW)
- Principle VIII: Multi-Language and Accessibility (NEW)

Templates Requiring Updates:
- âœ… Updated: .specify/memory/constitution.md
- âš ï¸ Pending: specs/001-002-phase-2/spec.md (should document completed features)
- âš ï¸ Pending: specs/001-002-phase-2/tasks.md (should mark completed tasks)

Follow-up TODOs:
- Create comprehensive Phase II spec documenting all completed features
- Create tasks.md with completion status for Phase II
- Consider creating ADR for authentication architecture decisions
- Consider creating ADR for multi-language implementation approach

Amendment Rationale:
- Document significant Phase II progress (landing page, auth, multi-language, advanced features)
- Capture new architectural patterns that emerged (authentication with GitHub OAuth, i18n with RTL)
- Provide clear visibility into remaining Phase II work
- Establish principle for multi-language support as core feature
-->

# Physical AI Todo Application - Constitution
**Version**: 1.1.0
**Ratified**: 2025-12-04
**Last Amended**: 2025-12-09
**Author**: Alishba Fatima
**Repository**: https://github.com/AlishbaFatima12/physical-ai-todo

---

## Purpose

This constitution governs the development of the Physical AI Todo Application across **5 evolutionary phases**, from a simple console app to a cloud-native AI-powered platform. It ensures:

- **Spec-Driven Development**: Every feature begins with a specification. Code generation via Claude Code only.
- **Phase-Correct Evolution**: Each phase builds on the previous without breaking changes.
- **Quality Standards**: 80%+ test coverage, comprehensive documentation, clean architecture.
- **Strategic Bonus Implementation**: Reusable intelligence, cloud-native blueprints, multi-language, voice commands.

**Core Constraint**: You **CANNOT write code manually**. You **MUST** refine specifications until Claude Code generates the correct output via `/sp.implement`.

---

## Core Principles

### I. Spec-Driven Development (MANDATORY - ZERO TOLERANCE)

**Every line of code MUST be generated by Claude Code via specifications. No exceptions.**

#### The Spec-First Rule
1. **Before ANY code**: Create specification via `/sp.specify`
2. **Before ANY implementation**: Create plan via `/sp.plan`
3. **Before ANY coding session**: Create tasks via `/sp.tasks`
4. **Code generation ONLY**: Use `/sp.implement` to generate code
5. **Refinement Loop**: If code is incorrect â†’ Refine spec â†’ Re-run `/sp.implement`

#### Prohibited Actions
- âŒ Writing code directly in `.py`, `.tsx`, `.ts` files
- âŒ Manual edits to generated code (except configuration files)
- âŒ Copy-pasting code from external sources
- âŒ Implementing features without approved specs

#### Allowed Actions
- âœ… Writing specifications in `specs/<feature>/spec.md`
- âœ… Writing plans in `specs/<feature>/plan.md`
- âœ… Writing tasks in `specs/<feature>/tasks.md`
- âœ… Refining specs based on generated code review
- âœ… Configuration files (`.env`, `docker-compose.yml`, `kubernetes/*.yaml`)
- âœ… Documentation files (`README.md`, ADRs, PHRs)

#### Specification Quality Requirements
Every spec MUST include:
- **User Story**: As a [role], I want [feature] so that [benefit]
- **Acceptance Criteria**: Observable, verifiable outcomes (Given/When/Then format)
- **Dependencies**: What must exist before this feature
- **Test Cases**: Minimum 3 test scenarios (happy path, edge cases, error cases)
- **Non-Functional Requirements**: Performance, security, UX constraints
- **API Contracts**: Input/output schemas for all interfaces

#### The Refinement Loop
```
1. Write Spec â†’ Approve
2. Generate Plan â†’ Approve
3. Generate Tasks â†’ Approve
4. Run /sp.implement â†’ Review Generated Code
5. If INCORRECT:
   â”œâ”€ Identify gaps in spec
   â”œâ”€ Refine spec with MORE detail
   â”œâ”€ Re-approve spec
   â””â”€ Re-run /sp.implement
6. If CORRECT:
   â”œâ”€ Run tests
   â”œâ”€ Commit changes
   â””â”€ Create PHR
```

**Maximum 3 refinement iterations per feature**. If failing after 3 iterations, break down into smaller features.

### II. Phase-Correct Evolution (NO PREMATURE FEATURES)

**Deliver each phase completely before starting the next. Architecture must support evolution without rewrites.**

Each phase has:
- **Defined scope**: Specific features to implement
- **Technology additions**: New tools/frameworks introduced
- **Architecture evolution**: How system structure changes
- **Data model extensions**: New fields/tables added
- **Backward compatibility**: Previous phase features continue working

### III. Authentication and Security First

**All user-facing applications MUST implement proper authentication before deployment.**

#### Authentication Requirements
- âœ… Email/password authentication with verification
- âœ… OAuth integration (GitHub, Google, etc.)
- âœ… JWT-based session management with httpOnly cookies
- âœ… Password hashing with bcrypt or similar
- âœ… Email verification for new accounts
- âœ… Secure password reset flow

#### Security Standards
- MUST validate all user input
- MUST use parameterized queries (SQL injection prevention)
- MUST implement CORS properly for cross-origin requests
- MUST use HTTPS in production
- MUST never store plaintext passwords
- MUST implement rate limiting on authentication endpoints

### IV. Test-Driven Quality

**80%+ test coverage is MANDATORY for all phases. Tests must pass before commits.**

#### Testing Standards
- **Unit Tests**: 70% of test suite (fast, isolated)
- **Integration Tests**: 20% of test suite (real database/API)
- **E2E Tests**: 10% of test suite (full user workflows)

#### Test Requirements Per Feature
- Minimum 3 test scenarios (happy path, edge case, error case)
- Tests written before or during implementation
- All tests pass before marking feature complete
- Coverage report generated and reviewed

### V. Modern UX and Design Standards

**Professional, polished user interfaces are REQUIRED, not optional.**

#### UI/UX Requirements
- âœ… Responsive design (mobile, tablet, desktop)
- âœ… Dark mode support with system detection
- âœ… Smooth animations (60fps target)
- âœ… Loading states and error messages
- âœ… Accessibility (WCAG 2.1 AA minimum)
- âœ… Professional color schemes and typography

#### Design Principles
- Glassmorphism effects with backdrop blur
- Gradient backgrounds for visual interest
- Consistent spacing and typography scale
- Clear visual hierarchy
- Intuitive navigation

### VI. API-First Architecture

**Backend APIs MUST be designed before frontend implementation.**

#### API Design Standards
- RESTful conventions (GET, POST, PUT, DELETE)
- Consistent response formats
- Proper HTTP status codes
- Comprehensive error messages
- API documentation (OpenAPI/Swagger)
- Versioning strategy (/api/v1/)

#### Backend Standards
- Input validation with Pydantic
- Structured error handling
- Database transactions for data integrity
- Proper logging for debugging
- Performance monitoring

### VII. Database Design Excellence

**Schema design MUST support evolution without breaking changes.**

#### Database Standards
- Proper indexing on frequently queried fields
- Foreign key constraints for data integrity
- Timestamps (created_at, updated_at) on all tables
- Soft deletes where appropriate
- Migration scripts for schema changes

#### Data Integrity
- NOT NULL constraints where appropriate
- CHECK constraints for valid values
- Unique constraints on natural keys
- Cascading deletes configured properly

### VIII. Multi-Language and Accessibility (NEW)

**Applications MUST support internationalization (i18n) and accessibility from the start.**

#### Multi-Language Requirements
- âœ… Support for at least 6 languages (English, Urdu, Arabic, Spanish, French, German)
- âœ… RTL (right-to-left) support for Arabic and Urdu
- âœ… Dynamic language switching without page reload
- âœ… Persistent language preference (cookies)
- âœ… Browser language auto-detection
- âœ… Fallback to English if translation missing

#### Implementation Standards
- Centralized translation files (JSON format)
- Translation keys following consistent naming (e.g., "app.title", "actions.add")
- No hardcoded strings in UI components
- Context provider pattern for i18n state management
- HTML `lang` and `dir` attributes updated dynamically

#### Accessibility Standards
- Semantic HTML (proper heading hierarchy)
- ARIA labels where needed
- Keyboard navigation support
- Focus management
- Screen reader compatibility
- Color contrast ratios meeting WCAG standards

---

## Phase I: In-Memory Python Console App
**Scope**: Basic CRUD operations in console interface
**Status**: âœ… COMPLETED

### Phase I Feature Scope (5 Features) - ALL COMPLETED

#### âœ… Implemented (Basic Level)
1. **Add Task** - Create new todo items with title and description
2. **View Task List** - Display all tasks in console
3. **Update Task** - Modify existing task details (title, description)
4. **Delete Task** - Remove tasks from the list
5. **Mark as Complete** - Toggle task completion status

### Phase I Technology Stack
- **Language**: Python 3.13+
- **CLI Framework**: `argparse` (standard library)
- **Storage**: In-memory (Python `list` of `dict`)
- **Testing**: `unittest` (standard library)
- **Dependencies**: ZERO external dependencies for core logic

### Phase I Data Model
```python
# In-memory storage: List[Dict]
{
    "id": int,            # Auto-generated, sequential (1, 2, 3, ...)
    "title": str,         # Required, max 200 chars
    "description": str,   # Optional, max 2000 chars
    "completed": bool,    # Default False
    "created_at": str     # ISO 8601 timestamp (datetime.now().isoformat())
}
```

### Phase I Success Criteria - âœ… ALL MET
- âœ… All 5 basic features working in console
- âœ… 80%+ test coverage (unittest)
- âœ… Zero external dependencies for core logic
- âœ… All specs, plans, tasks documented
- âœ… README.md with installation and usage instructions

---

## Phase II: Full-Stack Web Application
**Scope**: Web interface + Database + Intermediate features
**Status**: ğŸ”„ IN PROGRESS (80% Complete)

### Phase II Feature Scope

#### âœ… COMPLETED Features

**Core Migration (5 features)**
1. **Add Task** - Web UI with form validation
2. **View Task List** - Beautiful web interface with cards
3. **Update Task** - Modal-based editing
4. **Delete Task** - Confirmation dialog
5. **Mark as Complete** - One-click toggle with animation

**Intermediate Features (5 features)**
6. **Priorities** - Assign High/Medium/Low priority with visual indicators
7. **Tags/Categories** - Multi-tag support with colored badges
8. **Search Tasks** - Real-time search across title and description
9. **Filter Tasks** - By completion status, priority, tags
10. **Sort Tasks** - By created date, priority, title (ascending/descending)

**Advanced Organization (3 features - âœ… BONUS COMPLETED)**
11. **Subtasks** - Nested task breakdown with progress tracking
12. **Notes** - Rich text notes attached to tasks
13. **Attachments** - File upload and management per task

**Bulk Operations (âœ… BONUS COMPLETED)**
14. **Bulk Actions** - Select multiple tasks for batch operations
15. **Bulk Delete** - Delete multiple tasks at once
16. **Bulk Complete** - Mark multiple tasks complete

**Professional UI/UX (âœ… COMPLETED)**
17. **Landing Page** - Marketing page with features showcase
18. **Dark Mode** - Theme toggle with system detection
19. **Responsive Design** - Mobile, tablet, desktop layouts
20. **Glassmorphism UI** - Modern backdrop blur effects

**Authentication System (âœ… COMPLETED)**
21. **Email/Password Auth** - Sign up, sign in, logout
22. **Email Verification** - Token-based verification flow
23. **GitHub OAuth** - Social login integration
24. **Session Management** - JWT tokens with httpOnly cookies
25. **User Profile** - View current user information

**Multi-Language Support (âœ… COMPLETED - BONUS)**
26. **6 Languages** - English, Urdu, Arabic, Spanish, French, German
27. **RTL Support** - Right-to-left for Arabic and Urdu
28. **Language Switcher** - Dropdown with flags and native names
29. **Auto-Detection** - Browser language detection
30. **Persistent Preference** - Cookie-based language storage

#### â³ REMAINING Features (5 features)

**Productivity Features**
31. **Keyboard Shortcuts** - Quick actions (Ctrl+N, /, Escape, j/k navigation)
32. **Undo/Redo System** - Ctrl+Z/Ctrl+Y for task operations

**Data Management**
33. **Export/Import** - CSV and JSON formats
34. **Task Templates** - Reusable task patterns

**Analytics**
35. **Analytics Dashboard** - Task completion trends, productivity metrics

### Phase II Technology Stack

#### Backend
- **Framework**: FastAPI 0.100+
- **ORM**: SQLModel (Pydantic + SQLAlchemy)
- **Database**: Neon Postgres (serverless, cloud-native)
- **Validation**: Pydantic v2
- **Testing**: pytest
- **Authentication**: python-jose (JWT), passlib (bcrypt)
- **Email**: Resend API

#### Frontend
- **Framework**: Next.js 14+ (App Router)
- **Language**: TypeScript
- **UI Library**: Tailwind CSS
- **Animations**: framer-motion
- **State Management**: React Query (TanStack Query)
- **API Client**: fetch API with TypeScript types
- **i18n**: Custom React Context provider

### Phase II Data Model Evolution
```python
# SQLModel schema (compatible with Phase I model + extensions)
class User(SQLModel, table=True):
    id: int = Field(default=None, primary_key=True)
    email: str = Field(unique=True, index=True)
    hashed_password: str
    full_name: str | None = None
    is_active: bool = Field(default=True)
    is_verified: bool = Field(default=False)
    verification_token: str | None = None
    created_at: datetime
    updated_at: datetime

class Task(SQLModel, table=True):
    id: int = Field(default=None, primary_key=True)
    title: str = Field(max_length=200, index=True)
    description: str = Field(default="", max_length=2000)
    completed: bool = Field(default=False, index=True)
    created_at: datetime = Field(default_factory=datetime.now)
    updated_at: datetime = Field(default_factory=datetime.now)

    # NEW in Phase II
    priority: str = Field(default="medium")  # "high", "medium", "low"
    tags: str = Field(default="[]")  # JSON array stored as string

    # User ownership
    user_id: int = Field(foreign_key="user.id")

    # Advanced organization
    parent_task_id: int | None = Field(default=None, foreign_key="task.id")
    notes: str = Field(default="")
    attachments: str = Field(default="[]")  # JSON array of file references
```

### Phase II Architecture
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI application with CORS
â”‚   â”œâ”€â”€ models.py            # SQLModel schemas (User, Task)
â”‚   â”œâ”€â”€ crud.py              # Database operations
â”‚   â”œâ”€â”€ database.py          # Neon Postgres connection
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ routes.py        # Auth endpoints (register, login, OAuth)
â”‚   â”‚   â”œâ”€â”€ jwt.py           # JWT token creation/validation
â”‚   â”‚   â”œâ”€â”€ password.py      # Password hashing/verification
â”‚   â”‚   â”œâ”€â”€ dependencies.py  # Auth dependencies (get_current_user)
â”‚   â”‚   â””â”€â”€ email_service.py # Email sending (Resend API)
â”‚   â””â”€â”€ routes/
â”‚       â””â”€â”€ tasks.py         # Task CRUD API endpoints
â””â”€â”€ tests/
    â”œâ”€â”€ test_crud.py
    â”œâ”€â”€ test_api.py
    â””â”€â”€ test_auth.py

frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                    # Auth check and redirect
â”‚   â”œâ”€â”€ layout.tsx                  # Root layout with providers
â”‚   â”œâ”€â”€ landing/
â”‚   â”‚   â””â”€â”€ page.tsx                # Landing page
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ signup/page.tsx         # Sign up form
â”‚   â”‚   â”œâ”€â”€ signin/page.tsx         # Sign in form
â”‚   â”‚   â””â”€â”€ callback/github/page.tsx # OAuth callback
â”‚   â””â”€â”€ dashboard/
â”‚       â””â”€â”€ page.tsx                # Main task dashboard
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ TaskList.tsx                # Task list with filters
â”‚   â”œâ”€â”€ TaskForm.tsx                # Task creation/editing
â”‚   â”œâ”€â”€ FilterBar.tsx               # Search, filter, sort controls
â”‚   â”œâ”€â”€ TaskItem.tsx                # Individual task card
â”‚   â”œâ”€â”€ SubtaskList.tsx             # Subtask management
â”‚   â”œâ”€â”€ NoteList.tsx                # Task notes
â”‚   â”œâ”€â”€ AttachmentList.tsx          # File attachments
â”‚   â”œâ”€â”€ ThemeToggle.tsx             # Dark mode switcher
â”‚   â”œâ”€â”€ LanguageSwitcher.tsx        # Language dropdown
â”‚   â””â”€â”€ Providers.tsx               # Context providers wrapper
â”œâ”€â”€ contexts/
â”‚   â”œâ”€â”€ ThemeContext.tsx            # Dark mode state
â”‚   â”œâ”€â”€ AuthContext.tsx             # Authentication state
â”‚   â””â”€â”€ I18nContext.tsx             # Internationalization state
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts                      # API client functions
â”‚   â””â”€â”€ types.ts                    # TypeScript types
â””â”€â”€ public/
    â””â”€â”€ locales/
        â”œâ”€â”€ en/common.json          # English translations
        â”œâ”€â”€ ur/common.json          # Urdu translations
        â”œâ”€â”€ ar/common.json          # Arabic translations
        â”œâ”€â”€ es/common.json          # Spanish translations
        â”œâ”€â”€ fr/common.json          # French translations
        â””â”€â”€ de/common.json          # German translations
```

### Phase II: Implementation Progress

#### Completed Implementations (85% of Phase II)

**Foundation (âœ… Week 1)**
- Neon Postgres database setup
- SQLModel integration with FastAPI
- Basic CRUD operations migrated from Phase I
- API endpoints with proper validation
- CORS configuration for localhost development

**Professional UI/UX (âœ… Week 1)**
- Landing page with glassmorphism design
- Gradient backgrounds with animated orbs
- Dark mode with system detection and persistence
- Responsive layouts (mobile, tablet, desktop)
- Beautiful form designs with validation

**Authentication System (âœ… Week 2)**
- User registration with email validation
- Email verification flow with Resend API
- JWT authentication with httpOnly cookies
- GitHub OAuth integration (authorize + callback)
- Secure password hashing with bcrypt
- User session management
- Protected routes and API endpoints

**Intermediate Features (âœ… Week 2)**
- Priority assignment (High/Medium/Low) with visual indicators
- Multi-tag support with colored badges
- Real-time search functionality
- Advanced filtering (by status, priority, tags)
- Multi-criteria sorting (date, priority, title)

**Advanced Organization (âœ… Week 2 - BONUS)**
- Subtask support with parent-child relationships
- Task notes with rich text
- File attachments per task
- Progress tracking for subtasks

**Bulk Operations (âœ… Week 2 - BONUS)**
- Multi-select UI with checkboxes
- Bulk delete with confirmation
- Bulk complete toggle

**Multi-Language System (âœ… Week 2 - BONUS)**
- 6-language support (en, ur, ar, es, fr, de)
- RTL layout support for Arabic and Urdu
- Dynamic language switching
- Browser language auto-detection
- Translation files for all UI strings
- Language preference persistence in cookies
- HTML `lang` and `dir` attributes dynamically updated

**Technical Infrastructure (âœ… Ongoing)**
- React Query for data fetching
- framer-motion for animations
- TypeScript strict mode throughout
- Proper error handling and loading states
- API response formatting
- Cookie-based authentication flow

#### Remaining Implementations (15% of Phase II)

**Keyboard Shortcuts (â³ Estimated: 2-3 days)**
- Global shortcuts (Ctrl+N for new task, / for search, Escape for close)
- Undo/Redo shortcuts (Ctrl+Z, Ctrl+Y)
- Navigation shortcuts (j/k for up/down, Enter to open, d to delete)
- Help modal with shortcut list

**Undo/Redo System (â³ Estimated: 3-4 days)**
- Action history stack
- Undo for task operations (create, update, delete, complete)
- Redo for undone operations
- Visual feedback for undo/redo
- Keyboard shortcuts integration

**Export/Import (â³ Estimated: 2-3 days)**
- CSV export of tasks
- JSON export of tasks (full data)
- Import from CSV with field mapping
- Import from JSON with validation
- Download functionality
- Upload file handling

**Task Templates (â³ Estimated: 2-3 days)**
- Create template from existing task
- Save template with name
- Apply template to create new task
- Template management UI
- Template categories

**Analytics Dashboard (â³ Estimated: 3-4 days)**
- Task completion trends (line chart)
- Priority distribution (pie chart)
- Tag frequency (bar chart)
- Productivity metrics (tasks per day/week)
- Date range selector
- Chart library integration (recharts or Chart.js)

### Phase II Migration Strategy
1. âœ… Keep Phase I code: Preserved `src/todo/` as reference
2. âœ… Create new structure: `backend/` and `frontend/` directories established
3. âœ… Data migration: Postgres schema matches Phase I model structure
4. âœ… API compatibility: FastAPI endpoints follow REST conventions
5. âœ… Backward compatibility: All Phase I features working with enhancements

### Phase II Success Criteria

**Completed Criteria (âœ… 85%)**
- âœ… All 10 core features working (5 basic + 5 intermediate)
- âœ… Advanced features (subtasks, notes, attachments)
- âœ… Bulk operations
- âœ… Authentication system complete
- âœ… Multi-language support (6 languages with RTL)
- âœ… Web UI with responsive design
- âœ… Dark mode with system detection
- âœ… Neon Postgres integration
- âœ… API documentation (FastAPI auto-generated Swagger at /docs)
- âœ… React Query for state management
- âœ… Professional glassmorphism design
- âœ… Landing page and marketing content

**Remaining Criteria (â³ 15%)**
- â³ Keyboard shortcuts
- â³ Undo/Redo system
- â³ Export/Import (CSV/JSON)
- â³ Task templates
- â³ Analytics dashboard
- â³ 80%+ test coverage (pytest)
- â³ All specs, plans, tasks documented in `specs/001-002-phase-2/`
- â³ PHRs created for each feature implementation

### Phase II Bonus Features

#### âœ… COMPLETED Bonus Features
1. **Multi-Language Support** (COMPLETED - Week 2)
   - 6 languages implemented (en, ur, ar, es, fr, de)
   - RTL support for Arabic and Urdu
   - Dynamic switching without reload
   - Browser auto-detection
   - Persistent preferences

2. **Advanced Organization** (COMPLETED - Week 2)
   - Subtasks with parent-child relationships
   - Task notes (rich text capable)
   - File attachments per task

3. **Bulk Operations** (COMPLETED - Week 2)
   - Multi-select interface
   - Bulk delete with confirmation
   - Bulk complete toggle

4. **Professional UI** (COMPLETED - Week 1-2)
   - Landing page with features showcase
   - Glassmorphism design system
   - Dark mode with smooth transitions
   - Animated backgrounds
   - Responsive layouts

#### â³ REMAINING Bonus Features (Reusable Intelligence)
Add **Agent Skills** (from original plan):
1. **FastAPI CRUD Generator** - Generates boilerplate CRUD routes
2. **Next.js Component Generator** - Generates React components from specs
3. **Migration Generator** - Auto-generates Alembic migrations

Store in: `.claude/skills/`

---

## Phase III: AI-Powered Todo Chatbot
**Scope**: Conversational AI interface + Advanced features
**Status**: â³ NOT STARTED (planned after Phase II completion)

### Phase III Feature Scope

#### âœ… Must Implement (Advanced Level)
11. **Recurring Tasks** - Auto-reschedule repeating tasks (daily, weekly, monthly)
12. **Due Dates** - Date/time pickers for deadlines
13. **Time Reminders** - Browser notifications before due date

#### âœ… Must Implement (AI Integration)
14. **Natural Language Interface** - "Add task: Buy groceries tomorrow at 2pm"
15. **Intelligent Rescheduling** - "Reschedule my morning meetings to 2 PM"
16. **Task Suggestions** - AI suggests priorities, tags, due dates based on patterns

### Phase III Technology Stack

#### AI Components (NEW)
- **Chat Interface**: OpenAI ChatKit or custom React components
- **Agent Framework**: OpenAI Agents SDK or LangChain
- **Tool Integration**: Official MCP SDK (Model Context Protocol)
- **LLM**: OpenAI GPT-4 Turbo or Claude 3.5 Sonnet

#### Backend Extensions
- **Job Scheduler**: APScheduler (recurring tasks)
- **Notifications**: WebSockets (real-time browser notifications)
- **AI Router**: LangChain or direct OpenAI/Anthropic API

#### Frontend Extensions
- **Chat UI**: Custom chat components with framer-motion
- **Notifications**: Browser Notification API
- **Date Pickers**: react-datepicker or shadcn/ui date picker

### Phase III Data Model Evolution
```python
class Task(SQLModel, table=True):
    # ... Phase I & II fields ...

    # NEW in Phase III
    due_date: datetime | None = Field(default=None, index=True)
    recurrence: str | None = Field(default=None)  # JSON: {"type": "daily", "interval": 1}
    reminder_minutes: int = Field(default=0)  # 0 = no reminder, 15 = 15 min before
    ai_suggested_priority: str | None = Field(default=None)
    ai_suggested_tags: str = Field(default="[]")
```

### Phase III Success Criteria
- â³ All 13 features working (10 from Phase I-II + 3 advanced)
- â³ Conversational chatbot interface
- â³ Natural language task management
- â³ Recurring tasks auto-scheduling
- â³ Browser notifications working
- â³ 80%+ test coverage
- â³ All specs, plans, tasks documented in `specs/phase-3/`

### Phase III Bonus Features (from original plan)
1. **Voice Commands** âœ… (Already added to Phase III core)
   - Add voice input for chatbot
   - Use Web Speech API (browser)
   - Commands: "Add task...", "Show my tasks", "Mark complete..."

---

## Phase IV: Local Kubernetes Deployment
**Scope**: Containerization + Local K8s orchestration
**Status**: â³ NOT STARTED (planned after Phase III completion)

### Phase IV Technology Stack (NEW)
- **Containerization**: Docker + Docker Compose
- **Orchestration**: Kubernetes (Minikube for local)
- **Package Manager**: Helm (custom charts)
- **AI Tooling**: kubectl-ai (natural language K8s), kagent (AI K8s agent)
- **Service Mesh**: Istio or Linkerd (optional)

### Phase IV Success Criteria
- â³ All services containerized (multi-stage Docker builds)
- â³ Helm chart deploying to Minikube
- â³ All features working on local K8s
- â³ kubectl-ai integration for management
- â³ Health checks and readiness probes
- â³ 80%+ test coverage (integration tests in K8s)
- â³ All specs, plans, tasks documented in `specs/phase-4/`

---

## Phase V: Advanced Cloud Deployment
**Scope**: Production cloud deployment + Event-driven architecture
**Status**: â³ NOT STARTED (planned after Phase IV completion)

### Phase V Technology Stack (NEW)
- **Cloud Provider**: DigitalOcean Kubernetes (DOKS)
- **Event Streaming**: Apache Kafka
- **Microservices Runtime**: Dapr (Distributed Application Runtime)
- **Observability**: Prometheus + Grafana + Jaeger
- **CI/CD**: GitHub Actions + ArgoCD

### Phase V Success Criteria
- â³ Deployed to DigitalOcean DOKS
- â³ Event-driven architecture with Kafka
- â³ Dapr integration for pub/sub, state, secrets
- â³ Observability stack (metrics, logs, traces)
- â³ CI/CD pipeline (GitHub Actions â†’ ArgoCD)
- â³ Production-grade security (TLS, secrets management)
- â³ All specs, plans, tasks documented in `specs/phase-5/`

---

## Feature Levels (Implementation Across Phases)

### Basic Level (Core Essentials) - Phase I âœ… COMPLETED
Foundation features, quick to build, essential for MVP:
1. **Add Task** - Create new todo items
2. **Delete Task** - Remove tasks from list
3. **Update Task** - Modify existing task details
4. **View Task List** - Display all tasks
5. **Mark as Complete** - Toggle completion status

### Intermediate Level (Organization & Usability) - Phase II âœ… COMPLETED
Make the app polished and practical:
6. **Priorities** - Assign levels (high/medium/low)
7. **Tags/Categories** - Labels for organization (work/home/personal)
8. **Search & Filter** - Search by keyword; filter by status, priority, date
9. **Sort Tasks** - Reorder by due date, priority, or alphabetically

### Advanced Level (Intelligent Features) - Phase III â³ PLANNED
10. **Recurring Tasks** - Auto-reschedule repeating tasks (e.g., "weekly meeting")
11. **Due Dates & Time Reminders** - Set deadlines with date/time; browser notifications

---

## Project Structure (All Phases)

```
physical-ai-todo/
â”œâ”€â”€ .specify/
â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â””â”€â”€ constitution.md          # This file
â”‚   â”œâ”€â”€ templates/                    # Spec-Kit Plus templates
â”‚   â””â”€â”€ scripts/                      # Automation scripts
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ commands/                     # Slash commands
â”‚   â”œâ”€â”€ agents/                       # Reusable subagents (Bonus)
â”‚   â””â”€â”€ skills/                       # Reusable skills (Bonus)
â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ phase-1/                      # Phase I specs âœ…
â”‚   â”œâ”€â”€ 001-002-phase-2/              # Phase II specs ğŸ”„ IN PROGRESS
â”‚   â”œâ”€â”€ phase-3/                      # Phase III specs â³
â”‚   â”œâ”€â”€ phase-4/                      # Phase IV specs â³
â”‚   â””â”€â”€ phase-5/                      # Phase V specs â³
â”œâ”€â”€ history/
â”‚   â”œâ”€â”€ prompts/                      # PHRs per phase
â”‚   â””â”€â”€ adr/                          # Architecture Decision Records
â”œâ”€â”€ src/                              # Phase I: Console app âœ…
â”‚   â”œâ”€â”€ todo/
â”‚   â””â”€â”€ tests/
â”œâ”€â”€ backend/                          # Phase II+: FastAPI backend ğŸ”„
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â”œâ”€â”€ crud.py
â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â”œâ”€â”€ auth/                     # Authentication module âœ…
â”‚   â”‚   â””â”€â”€ routes/                   # API routes âœ…
â”‚   â””â”€â”€ tests/
â”œâ”€â”€ frontend/                         # Phase II+: Next.js frontend ğŸ”„
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ landing/                  # Landing page âœ…
â”‚   â”‚   â”œâ”€â”€ auth/                     # Auth pages âœ…
â”‚   â”‚   â””â”€â”€ dashboard/                # Main app âœ…
â”‚   â”œâ”€â”€ components/                   # React components âœ…
â”‚   â”œâ”€â”€ contexts/                     # State management âœ…
â”‚   â”œâ”€â”€ lib/                          # Utils and types âœ…
â”‚   â””â”€â”€ public/
â”‚       â””â”€â”€ locales/                  # Translation files âœ…
â”œâ”€â”€ kubernetes/                       # Phase IV+: K8s configs â³
â”‚   â”œâ”€â”€ charts/
â”‚   â””â”€â”€ docker/
â”œâ”€â”€ dapr/                             # Phase V: Dapr configs â³
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/                    # CI/CD â³
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ package.json
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ README.md
â””â”€â”€ CLAUDE.md

Legend:
âœ… Completed
ğŸ”„ In Progress
â³ Planned/Not Started
```

---

## Specification Standards

### Every Feature Specification Must Include

#### 1. Header
```markdown
# Feature: [Feature Name]
**Phase**: [I/II/III/IV/V]
**Priority**: [High/Medium/Low]
**Dependencies**: [List of prerequisite features]
```

#### 2. User Story
```markdown
## User Story
As a [role],
I want [feature],
So that [benefit].
```

#### 3. Acceptance Criteria (Given/When/Then)
```markdown
## Acceptance Criteria

### Scenario 1: [Happy Path]
- **Given** [initial context]
- **When** [action occurs]
- **Then** [expected outcome]

### Scenario 2: [Edge Case]
...

### Scenario 3: [Error Case]
...
```

#### 4. API Contract (if applicable)
```markdown
## API Contract

### Endpoint
`POST /api/tasks`

### Request
```json
{
  "title": "string (max 200)",
  "description": "string (max 2000, optional)",
  "priority": "high|medium|low (optional, default: medium)"
}
```

### Response (200 OK)
```json
{
  "id": 123,
  "title": "string",
  ...
}
```

### Errors
- 400 Bad Request: Invalid input
- 500 Internal Server Error: Database error
```

#### 5. Test Cases
```markdown
## Test Cases

### Unit Tests
1. `test_create_task_with_valid_data_returns_task`
2. `test_create_task_with_empty_title_raises_error`
3. `test_create_task_with_long_title_truncates`

### Integration Tests
1. `test_api_create_task_returns_201`
2. `test_api_create_task_persists_to_database`
```

#### 6. Non-Functional Requirements
```markdown
## Non-Functional Requirements
- **Performance**: API response < 200ms (p95)
- **Security**: Input validation, SQL injection prevention
- **UX**: Form validation with inline errors
```

---

## Testing Standards

### Coverage Requirements
- **Minimum**: 80% line coverage (all phases)
- **Target**: 90%+ for core business logic
- **Measurement**: `pytest --cov` or `coverage.py`

### Test Pyramid Distribution
- 70% Unit Tests (fast, isolated, mocked dependencies)
- 20% Integration Tests (medium speed, real database/API calls)
- 10% E2E Tests (slow, full user workflows)

### Test Naming Convention
```python
def test_<function>_<scenario>_<expected_outcome>():
    """Test that <function> <scenario> results in <expected outcome>"""
```

Examples:
- `test_add_task_with_valid_data_creates_task()`
- `test_add_task_with_empty_title_raises_ValueError()`
- `test_search_tasks_with_no_results_returns_empty_list()`

### Test Structure (Arrange-Act-Assert)
```python
def test_example():
    # Arrange: Set up test data and dependencies
    storage = TaskStorage()
    task_data = {"title": "Test Task"}

    # Act: Execute the functionality being tested
    result = storage.add_task(task_data)

    # Assert: Verify expected outcomes
    assert result["id"] is not None
    assert result["title"] == "Test Task"
```

---

## Architecture Decision Records (ADRs)

### When to Create ADR
Use the **three-part test** - ALL must be true:
1. **Impact**: Long-term consequences (framework, data model, API, security, platform)
2. **Alternatives**: Multiple viable options with different tradeoffs
3. **Scope**: Cross-cutting, influences system design

### ADR Examples for This Project
- âœ… **Phase I â†’ II Migration Strategy** (rewrite vs refactor vs parallel)
- âœ… **Storage Backend Choice** (SQLite vs Postgres vs MongoDB)
- âœ… **Authentication Strategy** (session vs JWT, cookie vs header)
- âœ… **Multi-Language Implementation** (next-i18next vs custom context)
- â³ **AI Framework Selection** (OpenAI Agents vs LangChain vs custom)
- â³ **K8s Packaging** (Helm vs Kustomize vs raw YAML)
- â³ **Event Streaming** (Kafka vs RabbitMQ vs Redis Streams)

### ADR Suggestion Format
```
ğŸ“‹ Architectural decision detected: [brief-description]
   Document reasoning and tradeoffs? Run `/sp.adr [decision-title]`
```

**Never auto-create ADRs. Always wait for user consent.**

---

## Prompt History Records (PHRs)

### PHR Creation (MANDATORY)
Create PHR after:
- âœ… Every feature implementation
- âœ… Every planning session
- âœ… Every debugging session
- âœ… Every spec/plan/task creation
- âœ… Every phase completion

Skip PHR for:
- âŒ Simple status queries
- âŒ `/sp.phr` command itself

### PHR Routing (All under `history/prompts/`)
- Constitution: `history/prompts/constitution/`
- Phase-specific: `history/prompts/phase-<N>/`
- Feature-specific: `history/prompts/phase-<N>/<feature-name>/`
- General: `history/prompts/general/`

### PHR File Naming
```
<ID>-<slug>.<stage>.prompt.md

Examples:
001-setup-phase-1.constitution.prompt.md
042-add-task-feature.green.prompt.md
103-deploy-to-doks.misc.prompt.md
```

---

## Bonus Features Strategy

### Bonus 1: Reusable Intelligence
**Goal**: Create reusable Claude Code subagents and skills across all phases

**Deliverables**:
1. **Subagents** (`.claude/agents/`)
   - Spec Generator Agent
   - Test Generator Agent
   - Refactoring Agent

2. **Agent Skills** (`.claude/skills/`)
   - FastAPI CRUD Generator
   - Next.js Component Generator
   - Migration Generator
   - Helm Chart Generator
   - Dockerfile Generator

**Implementation Timeline**:
- Phase I: Foundation (Spec Generator, Test Generator) âœ…
- Phase II: Web skills (CRUD Generator, Component Generator) â³
- Phase III: Complete (Refactoring Agent) â³
- Phase IV-V: Advanced (Cloud skills) â³

### Bonus 2: Cloud-Native Blueprints
**Goal**: Agent skills for Kubernetes and cloud-native patterns

**Implementation Timeline**:
- Phase IV: K8s skills â³
- Phase V: Dapr skills â³

### Bonus 3: Multi-language Support
**Goal**: Multi-language support in UI and future chatbot

**Status**: âœ… COMPLETED in Phase II (ahead of schedule!)
- 6 languages implemented (en, ur, ar, es, fr, de)
- RTL support for Arabic and Urdu
- Dynamic switching with persistence
- Browser auto-detection

### Bonus 4: Voice Commands
**Goal**: Voice input for todo operations

**Status**: â³ PLANNED for Phase III
- Voice input in chatbot (Web Speech API)
- Voice commands: "Add task...", "Show tasks", "Mark complete..."
- Fallback to text if voice fails

---

## Development Workflow (Spec-Driven)

### For Every Feature
1. **Specify** (`/sp.specify`)
   - Create `specs/phase-N/<feature-name>/spec.md`
   - Get user approval

2. **Plan** (`/sp.plan`)
   - Create `specs/phase-N/<feature-name>/plan.md`
   - Identify ADRs if needed
   - Get user approval

3. **Tasks** (`/sp.tasks`)
   - Create `specs/phase-N/<feature-name>/tasks.md`
   - Break into â‰¤30 min tasks
   - Get user approval

4. **Implement** (`/sp.implement`)
   - Generate code via Claude Code
   - **NO manual coding**
   - If incorrect â†’ Refine spec â†’ Re-implement

5. **Test**
   - Run test suite
   - Verify 80%+ coverage
   - All tests pass

6. **Commit** (`/sp.git.commit_pr`)
   - Commit with descriptive message
   - Reference spec/task IDs

7. **Record** (`/sp.phr`)
   - Create Prompt History Record
   - Document learnings

### Refinement Loop (If Generated Code is Incorrect)
```
1. Review generated code
2. Identify what's wrong
3. Identify gaps in spec (missing detail, unclear requirements)
4. Refine spec with MORE specificity
5. Re-approve spec
6. Re-run /sp.implement
7. Repeat max 3 times
8. If still failing â†’ Break feature into smaller pieces
```

---

## Quality Gates (Per Phase)

### Phase Completion Checklist
Before completing each phase:

- [ ] All features for this phase implemented
- [ ] All features from previous phases still working
- [ ] 80%+ test coverage
- [ ] All tests passing
- [ ] All specs documented in `specs/phase-N/`
- [ ] All PHRs created in `history/prompts/phase-N/`
- [ ] README.md updated with phase-specific instructions
- [ ] No manual code (all via `/sp.implement`)

### Code Quality Standards
- **Linting**: Pass `flake8` (Python), `eslint` (TypeScript)
- **Formatting**: `black` (Python), `prettier` (TypeScript)
- **Type Safety**: Type hints (Python), strict TypeScript
- **Documentation**: Docstrings (Python), JSDoc (TypeScript)

---

## Human as Tool Strategy

### Invocation Triggers
1. **Ambiguous Requirements**: Ask 2-3 clarifying questions
2. **Unforeseen Dependencies**: Surface and ask for prioritization
3. **Architectural Uncertainty**: Present options with pros/cons
4. **Completion Checkpoints**: Summarize and confirm next steps

### Example Interactions
```
â“ Clarification: Should recurring tasks create new instances or update existing?
  A) New instance each recurrence (preserve history)
  B) Update existing task (less clutter)

â“ Dependency: Search requires full-text indexing. Options:
  A) Simple LIKE queries (fast, less accurate)
  B) Postgres full-text search (slower, more powerful)
  C) External search engine (complex, best quality)

âœ… Phase II 85% Complete: Landing, auth, multi-language, advanced features done.
   Ready to complete remaining 5 features (shortcuts, undo/redo, export, templates, analytics)?
```

---

## Governance

### Constitution Authority
- This constitution **supersedes all other practices**
- All work MUST comply with this constitution
- Amendments require user approval

### Compliance Verification
- Every PR: Verify spec exists and was approved
- Every commit: Verify code generated via `/sp.implement`
- Every phase: Verify quality gates pass

### Amendment Process
1. Identify need for change
2. Create ADR documenting rationale (if architectural)
3. Update constitution
4. Get user approval
5. Increment version (MAJOR.MINOR.PATCH)

### Version History
- **1.0.0** (2025-12-04): Initial constitution
- **1.1.0** (2025-12-09): Added Phase II progress tracking, multi-language principle, authentication standards

---

## Quick Reference

### Slash Commands
- `/sp.constitution` - Update this constitution
- `/sp.specify` - Create feature specification
- `/sp.plan` - Create architectural plan
- `/sp.tasks` - Break down into tasks
- `/sp.implement` - Generate code (ONLY way to write code)
- `/sp.git.commit_pr` - Commit and create PR
- `/sp.phr` - Create Prompt History Record
- `/sp.adr` - Create Architecture Decision Record
- `/sp.clarify` - Ask clarifying questions
- `/sp.analyze` - Cross-artifact consistency check

### File Locations
- Constitution: `.specify/memory/constitution.md`
- Specs: `specs/phase-<N>/<feature>/spec.md`
- Plans: `specs/phase-<N>/<feature>/plan.md`
- Tasks: `specs/phase-<N>/<feature>/tasks.md`
- PHRs: `history/prompts/phase-<N>/`
- ADRs: `history/adr/`

### Phase Progression
- **Phase I**: Console app âœ… COMPLETE (5 basic features, in-memory)
- **Phase II**: Web app ğŸ”„ 85% COMPLETE (30 features done, 5 remaining)
- **Phase III**: AI chatbot â³ PLANNED (add 3 advanced features + AI, OpenAI)
- **Phase IV**: Local K8s â³ PLANNED (containerize, Minikube, Helm)
- **Phase V**: Cloud production â³ PLANNED (DOKS, Kafka, Dapr)

---

**Version**: 1.1.0
**Ratified**: 2025-12-04
**Last Amended**: 2025-12-09

**Remember**: You CANNOT write code manually. Refine specs until Claude Code generates correct output via `/sp.implement`. This is the essence of Spec-Driven Development.
