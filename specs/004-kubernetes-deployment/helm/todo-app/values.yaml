# Default values for todo-app Helm chart
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  domain: localhost
  environment: production

# Backend (FastAPI) configuration
backend:
  enabled: true
  name: backend
  replicaCount: 2

  image:
    repository: todo-backend
    tag: latest
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  env:
    DATABASE_URL: "postgresql://todouser:todopass@postgres:5432/tododb"
    SECRET_KEY: "your-secret-key-change-in-production"
    ALGORITHM: "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: "30"
    OPENAI_MODEL: "gpt-4-turbo-preview"
    CORS_ORIGINS: "http://localhost:3000"

  # Health checks
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Frontend (Next.js) configuration
frontend:
  enabled: true
  name: frontend
  replicaCount: 2

  image:
    repository: todo-frontend
    tag: latest
    pullPolicy: IfNotPresent

  service:
    type: LoadBalancer
    port: 3000
    targetPort: 3000

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  env:
    NEXT_PUBLIC_API_URL: "http://backend:8000"
    NODE_ENV: "production"

  # Health checks
  livenessProbe:
    httpGet:
      path: /api/health
      port: 3000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /api/health
      port: 3000
    initialDelaySeconds: 15
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# PostgreSQL database configuration
postgres:
  enabled: true
  name: postgres

  image:
    repository: postgres
    tag: 16-alpine
    pullPolicy: IfNotPresent

  service:
    type: ClusterIP
    port: 5432
    targetPort: 5432

  env:
    POSTGRES_USER: "todouser"
    POSTGRES_PASSWORD: "todopass"
    POSTGRES_DB: "tododb"

  persistence:
    enabled: true
    size: 1Gi
    storageClass: standard

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# Ingress configuration (optional, for production)
ingress:
  enabled: false
  className: nginx
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: todo.example.com
      paths:
        - path: /
          pathType: Prefix
          service:
            name: frontend
            port: 3000
        - path: /api
          pathType: Prefix
          service:
            name: backend
            port: 8000
  tls: []
  #  - secretName: todo-tls
  #    hosts:
  #      - todo.example.com

# ConfigMap and Secret settings
configMap:
  enabled: true
  data: {}

secrets:
  enabled: true
  data:
    openai-api-key: ""  # Set via --set or values override

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Autoscaling (HPA) - disabled by default
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
